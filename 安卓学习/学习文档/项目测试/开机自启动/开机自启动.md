> https://juejin.cn/post/7494083990069444648

# 开机自启动

测试系统开机应用自启动demo，看教程做法都是分以下几步：

- 注册开机结束权限
- 注册静态广播监听开机之后发送的系统广播（注意，只能注册静态广播，因为动态广播无法在未启动情况下注册广播）
- 处理监听逻辑，跳转并打开app

> 按上述步骤写完demo之后，开机重启发现app并没有自启动，打印监听日志也没有接收到广播，**后来询问作者，可能是因为非原生Android对广播隔离，应用无法接收到系统开机完成的广播**
>
> 因此，问gpt给出的处理方式是：**自定义个一个广播的action，模拟系统开机时候发送的系统广播**，最后成功实现。

下面按照这几个步骤依次讲解以下代码逻辑

## 1.详细步骤代码

### 注册开机结束权限

```xml
<uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
```



### 注册静态广播

按理说过滤`android.intent.action.BOOT_COMPLETED`即可接收到系统开机完成发出的广播，但是这里无法实现，因此自定义了一个action过滤。

```xml
<receiver
          android:name=".myreceiver.MyReceiver2"
          android:enabled="true"
          android:exported="true">
    <intent-filter>
        <action android:name="com.example.myapp.ACTION_BOOT_TEST"/>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```



### 广播接收处理逻辑

```java
public class MyReceiver2 extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        //过滤系统广播的action
        if(intent!=null && Intent.ACTION_BOOT_COMPLETED.equals(intent.getAction())){
            Intent intent1 = new Intent(context, MainActivity.class);
            intent1.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            context.startActivity(intent1);
        } else if ("com.example.myapp.ACTION_BOOT_TEST".equals(intent.getAction())) {
            //过滤自定义的广播action
            Intent intent1 = new Intent(context, MainActivity.class);
            intent1.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            context.startActivity(intent1);
        }
    }
}
```



### 发送自定义广播信息

**这一步满关键的，特别是-n后面的具体参数名称**

```shell
adb shell am broadcast -a com.example.myapp.ACTION_BOOT_TEST -n com.yht.auto_boot/.myreceiver.MyReceiver2
```

> adb shell am broadcast \
>     -a <你的动作名> \
>     -n <包名>/<组件名>
>
> `<包名>`：你应用的 `applicationId`，比如 `com.example.myapp
>
> `<组件名>`：
>
> - 如果写成 `.BootReceiver`，就相当于 `com.example.myapp.BootReceiver`
> - 也可以写全路径，比如 `com.example.myapp.receivers.BootReceiver`

发送之后应用就会自启动了。（但是注意要手动启动一起，这样静态广播才会注册）