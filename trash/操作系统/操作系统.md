# 一、进程管理

## 1.进程

我们编写的代码通过编译后就会生成二进制可执行文件，当运行这个可执行文件后，它会被装载到内存中，接着 CPU 会执行程序中的每一条指令，那么这个**运行中的程序，就被称为「进程」（Process）**。 

### **并发**

对于一个支持多进程的单核CPU，CPU从一个进程快速切换到另一个进程，每个进程运行几十毫秒，这在宏观上看似并行，其实微观上时并发。

### 进程状态

**一个进程的活动期间至少具备三种基本状态，即运行状态、就绪状态、阻塞状态。** 

 ![进程的三种基本状态](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/7-%E8%BF%9B%E7%A8%8B%E4%B8%89%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%8A%B6%E6%80%81.jpg) 

如果加入创建和结束，那么就是：

![进程五种状态的变迁](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/8-%E8%BF%9B%E7%A8%8B%E4%BA%94%E4%B8%AA%E7%8A%B6%E6%80%81.jpg) 

> 当由大量阻塞状态进程时候，可能会导致内存浪费，因此在虚拟内存管理的操作系统中，会把阻塞状态的进程的物理内存空间换到硬盘，等需要再次运行的时候，再从硬盘换入到物理内存。 

需要一个新的状态，来**描述进程没有占用实际的物理内存空间的情况，这个状态就是挂起状态**。 

 ![七种状态变迁](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/10-%E8%BF%9B%E7%A8%8B%E4%B8%83%E4%B8%AD%E7%8A%B6%E6%80%81.jpg) 

### 进程的结构控制

在操作系统中，是用**进程控制块**（*process control block，PCB*）数据结构来描述进程的。  **PCB 是进程存在的唯一标识** 



### 进程的上下文切换

**一个进程切换到另一个进程运行，称为进程的上下文切换**。 

> 进程是由内核管理和调度的，所以进程的切换只能发生在内核态。 

**进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。** 

> **进程上下文切换有哪些场景：**
>
> - 为了保证所有进程可以得到公平调度，CPU 时间被划分为一段段的时间片，这些时间片再被轮流分配给各个进程。这样，当某个进程的时间片耗尽了，进程就从运行状态变为就绪状态，系统从就绪队列选择另外一个进程运行；
> - 进程在系统资源不足（比如内存不足）时，要等到资源满足后才可以运行，这个时候进程也会被挂起，并由系统调度其他进程运行；
> - 当进程通过睡眠函数 sleep 这样的方法将自己主动挂起时，自然也会重新调度；
> - 当有优先级更高的进程运行时，为了保证高优先级进程的运行，当前进程会被挂起，由高优先级进程来运行；
> - 发生硬件中断时，CPU 上的进程会被中断挂起，转而执行内核中的中断服务程序；



### 进程间通信

1. 管道（Pipe）：管道是一种半双工通信方式，它可以用于具有亲缘关系的进程之间的通信。管道有两种形式：匿名管道和命名管道。匿名管道只能用于具有亲缘关系的进程之间的通信，而命名管道则可以用于任意两个进程之间的通信。
2. 消息队列（Message Queue）：消息队列是一种用于进程间通信的内核数据结构，它可以用于无亲缘关系的进程之间的通信。消息队列允许进程向队列中发送和接收消息，每个消息都有一个特定的类型，接收进程可以根据消息类型来处理消息。
3. 共享内存（Shared Memory）：共享内存是一种允许多个进程访问同一块内存区域的机制。共享内存通常用于需要大量数据交换的进程间通信中，因为它可以减少数据拷贝的开销。
4. 信号量（Semaphore）：信号量是一种用于进程间同步和互斥的机制。信号量可以用于控制对共享资源的访问，以避免进程间的竞争条件。
5. 套接字（Socket）：套接字是一种用于网络通信的机制，它也可以用于进程间通信。套接字允许进程在网络上发送和接收数据，从而实现进程间的通信。
6. 远程过程调用（RPC）：远程过程调用是一种允许进程在网络上调用其他进程的函数或过程的机制。RPC可以用于实现分布式系统中的进程间通信。





## 2.线程

**线程是进程当中的一条执行流程。是程序执行的基本单位 **

### 线程的优点：

- 一个进程中可以同时存在多个线程；
- 各个线程之间可以并发执行；
- 各个线程之间可以共享地址空间和文件等资源；

### 线程上下文切换

线程的上下文切换开销，比进程上下文切换小得多。

- 当两个线程不是属于同一个进程，则切换的过程就跟进程上下文切换一样；
- **当两个线程是属于同一个进程，因为虚拟内存是共享的，所以在切换时，虚拟内存这些资源就保持不动，只需要切换线程的私有数据、寄存器等不共享的数据**；

### 线程与进程比较

线程与进程的比较如下：

- 进程是资源（包括内存、打开的文件等）分配的单位，线程是 CPU 调度的基本单位；
- 进程是拥有资源的一个独立单位，线程不拥有系统资源，但是可以访问隶属于进程的资源。 
- 线程同样具有就绪、阻塞、执行三种基本状态，同样具有状态之间的转换关系；
- 线程能减少并发执行的时间和空间开销；
- 线程的上下文切换比进程快得多，且开销也小很多